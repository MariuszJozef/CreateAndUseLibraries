# Demo of how to write CMake installable libraries: static, shared, header-only with an auto generated `<packageName>Config.cmake` installation file.

Various libraries (header-only, static, shared) are created by CMake, each with its own compiler standard (C++14, C++17, C++20) because each one uses specific features available in a given C++ standard. But the libraries do not propagate that standard requirement onto projects that link these libraries. So here an executable program is made to use these libraries, and for itself it needs only to be compiled with C++11. 

The libraries are moreover packaged into an installable package with an auto generated <packageName>Config.cmake file which allows other programs (not build in this project) to easily find and link these libraries.

Here is a sibling program that uses the `<packageName>Config.cmake` file to link and use the libraries provided here: [ImportAndUseLibraries](https://github.com/MariuszJozef/ImportAndUseLibraries.git). If this library is not preinstalled, then the sibling project will fetch this project from this repo and incorporate it into its own build.

Here is the project structure:
```
git clone --depth 1 https://github.com/MariuszJozef/CreateAndUseLibraries.git
cd CreateAndUseLibraries
```
```
.
├── CMakeLists.txt
├── CMakePresets.json
├── CMakeUtils
│   ├── Handy
│   │   ├── DisallowInSourceBuilds.cmake
│   │   ├── DisplayGenericInfo.cmake
│   │   └── SelectCompilerViaFlagIfNotUsingCMakePresets.cmake
│   ├── Package
│   │   ├── InstallPackage.cmake
│   │   └── LibrarySuiteConfig.cmake.in
│   └── Presets
│       ├── BuildType.json
│       ├── Compilers.json
│       ├── Platforms.json
│       └── SingleConfigGenerators.json
├── HeaderLibNeedsCpp14
│   ├── CMakeLists.txt
│   └── include
│       ├── HeaderLib.hpp
│       └── HeaderLibApi.hpp
├── README.md
├── SharedLibNeedsCpp17
│   ├── CMakeLists.txt
│   ├── hdr
│   │   └── SharedLibPrivate.hpp
│   ├── include
│   │   ├── AutoGeneratedSharedLibExports.hpp
│   │   └── SharedLibApi.hpp
│   └── src
│       ├── SharedLibApi.cpp
│       └── SharedLibPrivate.cpp
├── SharedOrStaticLibNeedsCpp17
│   ├── CMakeLists.txt
│   ├── hdr
│   │   └── SharedOrStaticLibPrivate.hpp
│   ├── include
│   │   ├── AutoGeneratedSharedOrStaticLibExports.hpp
│   │   └── SharedOrStaticLibApi.hpp
│   └── src
│       ├── SharedOrStaticLibApi.cpp
│       └── SharedOrStaticLibPrivate.cpp
├── StaticLibNeedsCpp20
│   ├── CMakeLists.txt
│   ├── hdr
│   │   └── StaticLibPrivate.hpp
│   ├── include
│   │   └── StaticLibApi.hpp
│   └── src
│       ├── StaticLibApi.cpp
│       └── StaticLibPrivate.cpp
└── UseCreatedLibsNeedsCpp11
    ├── CMakeLists.txt
    ├── hdr
    │   └── UseCreatedLibraries.hpp
    └── src
        ├── MainUseCreatedLibraries.cpp
        └── UseCreatedLibraries.cpp
```
The subproject SharedOrStaticLibNeedsCpp17 can be built either into a static or a shared library, determined by the flag `-D BUILD_SHARED_LIBS=<ON/OFF>`, if ON, it will be a shared library, otherwise static.

## Layout of binaries in the build tree

On Windows the dynamic (shared) libraries are copied by CMake next to the binary, here is the build structure when the library suite is installed twice (once with BUILD_SHARED_LIBS=ON and again with OFF):
```
cmake --preset VSx64-Msvc -D CMAKE_INSTALL_PREFIX=C:/Packages/LibrarySuite -D BUILD_SHARED_LIBS=ON
cmake --build --preset VSx64-Msvc --config Debug
cmake --build --preset VSx64-Msvc --config Debug --target run
cmake --build --preset VSx64-Msvc --config Debug --target install

and again

cmake --preset VSx64-Msvc -D CMAKE_INSTALL_PREFIX=C:/Packages/LibrarySuite -D BUILD_SHARED_LIBS=OFF
cmake --build --preset VSx64-Msvc --config Debug
cmake --build --preset VSx64-Msvc --config Debug --target run install
```
```
C:/Packages/LibrarySuite/
├───bin
│   └───Debug
│           SharedLibrary_d.dll
│           SharedOrStaticLibrary_shared_d.dll
│           UseCreatedLibraries_d.exe
│
├───include
│       AutoGeneratedSharedLibExports.hpp
│       AutoGeneratedSharedOrStaticLibExports.hpp
│       HeaderLib.hpp
│       HeaderLibApi.hpp
│       SharedLibApi.hpp
│       SharedOrStaticLibApi.hpp
│       StaticLibApi.hpp
│
├───lib
│   └───Debug
│           SharedLibrary_d.lib
│           SharedOrStaticLibrary_shared_d.lib
│           SharedOrStaticLibrary_static_d.lib
│           StaticLibrary_d.lib
│
└───share
    └───cmake
            LibrarySuiteConfig.cmake
            LibrarySuiteConfigVersion.cmake
            LibrarySuiteTargets-debug.cmake
            LibrarySuiteTargets.cmake
```

If the `CMAKE_INSTALL_PREFIX` is omitted, the default install location will be within the build tree, e.g. on Linux (here shared libraries do not need to, and are not copied next to the executable):
```
cmake -S . -B buildMake/Gnu -G "Unix Makefiles" -D BUILD_SHARED_LIBS=ON -D CMAKE_BUILD_TYPE=Debug
cmake --build buildMake/Gnu/ -j8
cmake --build buildMake/Gnu/ -j8 --target run
cmake --install buildMake/Gnu/

or alternatively, instead of the last command:

cmake --build buildMake/Gnu/ -j8 --target install
```
```
buildMake/Gnu/install
└── LibrarySuite0.1.0
    ├── shared
    │   ├── bin
    │   │   └── Debug
    │   │       └── UseCreatedLibraries_d
    │   ├── include
    │   │   ├── AutoGeneratedSharedLibExports.hpp
    │   │   ├── AutoGeneratedSharedOrStaticLibExports.hpp
    │   │   ├── HeaderLib.hpp
    │   │   ├── HeaderLibApi.hpp
    │   │   ├── SharedLibApi.hpp
    │   │   ├── SharedOrStaticLibApi.hpp
    │   │   └── StaticLibApi.hpp
    │   ├── lib64
    │   │   └── Debug
    │   │       ├── libSharedLibrary_d.so
    │   │       ├── libSharedOrStaticLibrary_shared_d.so
    │   │       └── libStaticLibrary_d.a
    │   └── share
    │       └── cmake
    │           ├── LibrarySuiteConfig.cmake
    │           ├── LibrarySuiteConfigVersion.cmake
    │           ├── LibrarySuiteTargets-debug.cmake
    │           └── LibrarySuiteTargets.cmake
    └── static
        ├── bin
        │   └── Debug
        │       └── UseCreatedLibraries_d
        ├── include
        │   ├── AutoGeneratedSharedLibExports.hpp
        │   ├── AutoGeneratedSharedOrStaticLibExports.hpp
        │   ├── HeaderLib.hpp
        │   ├── HeaderLibApi.hpp
        │   ├── SharedLibApi.hpp
        │   ├── SharedOrStaticLibApi.hpp
        │   └── StaticLibApi.hpp
        ├── lib64
        │   └── Debug
        │       ├── libSharedLibrary_d.so
        │       ├── libSharedOrStaticLibrary_static_d.a
        │       └── libStaticLibrary_d.a
        └── share
            └── cmake
                ├── LibrarySuiteConfig.cmake
                ├── LibrarySuiteConfigVersion.cmake
                ├── LibrarySuiteTargets-debug.cmake
                └── LibrarySuiteTargets.cmake
```

The command `cmake --install <buildDir>` cannot be used with CMake presets (i.e. it can only be used when CMakePresets.json is not invoked); to install with presets the requisite command is: 
```
cmake --build --preset <presetName> --config <buildType> --target install
```
Moreover, without presets with install command allows one to overwrite previously specified install directory:
```
cmake --install <buildDir> --prefix <new/install/dir/relative/current/dir>
```
